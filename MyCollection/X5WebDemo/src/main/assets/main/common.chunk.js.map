{"version":3,"sources":["D:/witontekGit/witon_git_minipay_web2017/dev/app/ng4/src/app/base-component/outpatient-billing-base/outpatient-billing-base.component.css","D:/witontekGit/witon_git_minipay_web2017/dev/app/ng4/src/app/base-component/outpatient-billing-base/outpatient-billing-base.component.html","D:/witontekGit/witon_git_minipay_web2017/dev/app/ng4/src/app/base-component/outpatient-billing-base/outpatient-billing-base.component.ts"],"names":[],"mappings":"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","file":"common.chunk.js","sourcesContent":["exports = module.exports = require(\"../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \"/*门诊缴费记录*/\\r\\n.content {\\r\\n  padding: 0.1953rem;\\r\\n}\\r\\n\\r\\n/*空记录*/\\r\\n.empty-box {\\r\\n  display: -webkit-box;\\r\\n  display: -ms-flexbox;\\r\\n  display: flex;\\r\\n  -webkit-box-align: center;\\r\\n      -ms-flex-align: center;\\r\\n          align-items: center;\\r\\n  -webkit-box-orient: vertical;\\r\\n  -webkit-box-direction: normal;\\r\\n      -ms-flex-direction: column;\\r\\n          flex-direction: column;\\r\\n  font-size: 0.3125rem;\\r\\n  color: #666;\\r\\n}\\r\\n\\r\\n.empty-box img {\\r\\n  width: 1.5625rem;\\r\\n  height: 1.5625rem;\\r\\n  margin: 0.3906rem auto;\\r\\n}\\r\\n\", \"\"]);\n\n// exports\n\n\n/*** EXPORTS FROM exports-loader ***/\nmodule.exports = module.exports.toString();\n\n\n//////////////////\n// WEBPACK FOOTER\n// D:/witontekGit/witon_git_minipay_web2017/dev/app/ng4/src/app/base-component/outpatient-billing-base/outpatient-billing-base.component.css\n// module id = ../../../../../src/app/base-component/outpatient-billing-base/outpatient-billing-base.component.css\n// module chunks = common","module.exports = \"<div class=\\\"common-page\\\">\\r\\n  \\r\\n  <!--头部-->\\r\\n  <app-main-header [timerShow]=\\\"true\\\" [timerMax]=\\\"120\\\"></app-main-header>\\r\\n  \\r\\n  <!--账单列表-->\\r\\n  <div class=\\\"content\\\">\\r\\n    \\r\\n    <!--item of list-->\\r\\n    <app-billing-item\\r\\n      *ngFor=\\\"let item of recordList\\\"\\r\\n      [showCheck]=\\\"true\\\"\\r\\n      [showExpand]=\\\"true\\\"\\r\\n      [showTimeDetail]=\\\"showTimeDetailInOutpatientBillingItem\\\"\\r\\n      [itemValue]=\\\"item\\\"\\r\\n      (changed)=\\\"itemSelectChangeHandle($event)\\\"></app-billing-item>\\r\\n    \\r\\n    <!--无记录-->\\r\\n    <div *ngIf=\\\"billListEmpty\\\" class=\\\"empty-box\\\">\\r\\n      <img src=\\\"assets/images/icon_blank.png\\\">\\r\\n      暂无您的门诊费用记录\\r\\n    </div>\\r\\n    \\r\\n  </div>\\r\\n  \\r\\n  <!--底部-->\\r\\n  <app-billing-bar\\r\\n    [showCheck]=\\\"true\\\"\\r\\n    [showMoney]=\\\"true\\\"\\r\\n    [showBtnPay]=\\\"true\\\"\\r\\n    [btnTitle]=\\\"btnTitle\\\"\\r\\n    [total]=\\\"billAmount\\\"\\r\\n    [isSelectAll]=\\\"true\\\"\\r\\n    (changed)=\\\"selectAllHandle($event)\\\"\\r\\n    (clicked)=\\\"btnPayClickHandle()\\\"\\r\\n  ></app-billing-bar>\\r\\n</div>\\r\\n\"\n\n\n//////////////////\n// WEBPACK FOOTER\n// D:/witontekGit/witon_git_minipay_web2017/dev/app/ng4/src/app/base-component/outpatient-billing-base/outpatient-billing-base.component.html\n// module id = ../../../../../src/app/base-component/outpatient-billing-base/outpatient-billing-base.component.html\n// module chunks = common","// 门诊病人的缴费记录，未缴费\r\n\r\nimport {Component, OnInit} from '@angular/core';\r\n\r\nimport {ProxyLibrary} from 'app/core/libs/proxy-library';\r\nimport {LogService} from 'app/core/services/log.service';\r\nimport {ErrorService} from 'app/core/services/error.service';\r\nimport {LoadingService} from 'app/core/services/loading.service';\r\nimport {RouterService} from 'app/core/services/router.service';\r\nimport {UserService} from 'app/core/services/user.service';\r\nimport {InfoMessage} from 'app/core/objects/info-message';\r\nimport {OutpatientPayRecordVo} from 'app/core/objects/outpatient-pay-record-vo';\r\nimport {InfoLibrary} from 'app/core/libs/info-library';\r\nimport {SystemService} from 'app/core/services/system.service';\r\nimport {OutputQueryOutpatientPayRecords} from 'app/protocol/server/output-query-outpatient-pay-records';\r\nimport {OutputQueryOutpatientPayRecordsListItem} from 'app/protocol/server/output-query-outpatient-pay-records-list-item';\r\n\r\n@Component({\r\n  selector: 'app-outpatient-billing-base',\r\n  templateUrl: './outpatient-billing-base.component.html',\r\n  styleUrls: ['./outpatient-billing-base.component.css']\r\n})\r\nexport class OutpatientBillingBaseComponent implements OnInit {\r\n\r\n  protected recordList: Array<OutpatientPayRecordVo> = new Array<OutpatientPayRecordVo>(); // 账单明细\r\n  protected billAmount = ''; // 费用账单总金额\r\n  protected btnTitle = InfoLibrary.tipsGotoPay; // 按钮上显示的名字\r\n  protected billListEmpty = false; // 账单明细列表是否为空\r\n  protected showTimeDetailInOutpatientBillingItem = ProxyLibrary.getShowTimeDetailInOutpatientBillingItem();\r\n\r\n  protected selectedRecord: OutpatientPayRecordVo; // 被选中的条目\r\n\r\n  constructor(protected routerService: RouterService,\r\n              protected userService: UserService,\r\n              protected systemService: SystemService,\r\n              protected errorService: ErrorService,\r\n              protected loadingService: LoadingService) {\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.init();\r\n  }\r\n\r\n  // 全选 改变时触发\r\n  selectAllHandle(isSelectAll: boolean): void {\r\n    this.selectAll(isSelectAll);\r\n  }\r\n\r\n  // item 改变选中与否时触发\r\n  itemSelectChangeHandle(itemValueChanged: OutpatientPayRecordVo): void {\r\n\r\n    if (itemValueChanged.isSelect === true) {\r\n      // 保证其他 item 不被选中\r\n      this.check4RadioBtn(itemValueChanged, this.recordList);\r\n    }\r\n\r\n    // 重新计算支付金额\r\n    this.countAmount();\r\n  }\r\n\r\n  // 支付按钮被点击时触发\r\n  btnPayClickHandle(): void {\r\n    this.goToPaymentAmountSelect();\r\n  }\r\n\r\n  protected init() {\r\n    this.getOutpatientPayRecords();\r\n  }\r\n\r\n  // 为保证单选框有效的校验，将其他项进行修改，以保证同时只有一个选中\r\n  // itemValueChanged.isSelect 应保证为 true\r\n  private check4RadioBtn(itemValueChanged: OutpatientPayRecordVo,\r\n                         list: Array<OutpatientPayRecordVo>): void {\r\n    if (itemValueChanged.isSelect === true) {\r\n      // 保存\r\n      this.selectedRecord = itemValueChanged;\r\n\r\n      // 确保其他项不被选中\r\n      list.forEach(\r\n        (itemValue: OutpatientPayRecordVo) => {\r\n          if (itemValue !== itemValueChanged) {\r\n            itemValue.isSelect = false;\r\n          }\r\n        }\r\n      );\r\n\r\n    }\r\n  }\r\n\r\n  // 设置为全选或全不选\r\n  private selectAll(selectAll: boolean): void {\r\n    this.recordList.forEach(\r\n      (itemValue: OutpatientPayRecordVo) => {\r\n        itemValue.isSelect = selectAll;\r\n      }\r\n    );\r\n  }\r\n\r\n  // 从服务器获取门诊缴费记录（未缴费用）\r\n  private getOutpatientPayRecords(): void {\r\n    this.loadingService.showLoading();\r\n\r\n    this.userService.getOutpatientPayRecordsFromServer().subscribe(\r\n      data => this.getOutpatientPayRecordsSuc(data),\r\n      error => this.getOutpatientPayRecordsErr(error)\r\n    );\r\n  }\r\n\r\n  // 从服务器获取门诊缴费记录（未缴费用），成功\r\n  private getOutpatientPayRecordsSuc(outputQueryOutpatientPayRecords: OutputQueryOutpatientPayRecords): void {\r\n    LogService.debug('getOutpatientPayRecordsSuc: ' + outputQueryOutpatientPayRecords);\r\n\r\n    if (outputQueryOutpatientPayRecords.list) {\r\n\r\n      // 构造内部的数据列表\r\n      outputQueryOutpatientPayRecords.list.forEach(\r\n        (item: OutputQueryOutpatientPayRecordsListItem) => {\r\n          if ((item != null) && (typeof item !== 'undefined')) {\r\n            const outpatientPayRecordVo: OutpatientPayRecordVo = new OutpatientPayRecordVo(item, false);\r\n            this.recordList.push(outpatientPayRecordVo);\r\n          }\r\n        }\r\n      );\r\n\r\n      // 默认选中第一个\r\n      const firstItem: OutpatientPayRecordVo = this.recordList[0];\r\n      firstItem.isSelect = true;\r\n      this.check4RadioBtn(firstItem, this.recordList);\r\n\r\n      // 计算需要付费的金额\r\n      this.countAmount();\r\n\r\n    } else {\r\n\r\n      // 设置列表为空的标记\r\n      this.billListEmpty = true;\r\n    }\r\n\r\n    this.loadingService.hiddenLoading();\r\n  }\r\n\r\n  // 从服务器获取门诊缴费记录（未缴费用），失败\r\n  private getOutpatientPayRecordsErr(errorMsg: string): void {\r\n    LogService.error('getOutpatientPayRecordsErr: ' + errorMsg);\r\n    this.loadingService.hiddenLoading();\r\n\r\n    if (errorMsg !== InfoLibrary.networkError) {\r\n      // 普通错误\r\n      const infoMessage: InfoMessage = new InfoMessage(errorMsg);\r\n      this.errorService.showError(infoMessage);\r\n    } else {\r\n      // 网络错误，跳去指定UI\r\n      this.systemService.gotoErrorWait();\r\n    }\r\n  }\r\n\r\n  // 计算应付的总金额\r\n  protected countAmount(): void {\r\n    let total = 0;\r\n    this.recordList.forEach(\r\n      (outpatientPayRecordVo: OutpatientPayRecordVo) => {\r\n        if (outpatientPayRecordVo.isSelect) {\r\n          total += parseFloat(outpatientPayRecordVo.outpatientPayRecordsListItem.order_amount);\r\n        }\r\n      }\r\n    );\r\n    total = Math.round(total * 100) / 100; // 圆整\r\n    this.billAmount = total.toString();\r\n  }\r\n\r\n  // 跳转去支付界面\r\n  private goToPaymentAmountSelect(): void {\r\n    if (parseFloat(this.billAmount) === 0) {\r\n      // 金额为0，只显示提示即可\r\n      const infoMessage: InfoMessage = new InfoMessage(InfoLibrary.paymentAmountError);\r\n      infoMessage.noRouter = true; // 关闭时无需跳转\r\n      infoMessage.autoCloseTime = 3000; // 自动关闭倒计时毫秒\r\n      this.errorService.showError(infoMessage);\r\n\r\n    } else {\r\n      // 金额非0\r\n      this.goToPaymentUI();\r\n\r\n    }\r\n  }\r\n\r\n  // 跳转支付UI，各子类自行实现\r\n  protected goToPaymentUI(): void {\r\n    // const payInfo: PayInfo = this.userService.getPayInfo();\r\n    // payInfo.dataSrc = SqsrmyyLibrary.outpatientPayType;\r\n    // payInfo.totalAmount = this.billAmount;\r\n    // payInfo.visitID = this.selectedRecord.outpatientPayRecordsListItem.his_id;\r\n    //\r\n    // this.routerService.goTo([PathLibrary.paymentTypeSelect]);\r\n  }\r\n\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// D:/witontekGit/witon_git_minipay_web2017/dev/app/ng4/src/app/base-component/outpatient-billing-base/outpatient-billing-base.component.ts"],"sourceRoot":"webpack:///"}